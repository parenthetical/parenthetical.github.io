<!DOCTYPE html>
<html lang="en">
  	<head>
		<meta charset="utf-8"/>
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<meta name="generator" content="Hugo 0.147.3">
		<title>2025-03-23 - Adriaan Leijnse</title>

		<meta name="description" content="I&rsquo;ve been thinking about why GHC&rsquo;s front-end code is so big and complicated/fragile feeling.
I think it might be because of the huge Expr data structure that is meant to represent the full surface syntax, and is used throughout the parser, renamer, and type checker phases.
Maybe this makes it so that various concerns are all intermingled, even though there are these separate &ldquo;phases&rdquo; that traditional compiler designers like to use.">


		
	
		




<link rel="stylesheet" href="/css/ui.css">

	
		

		<link  rel="stylesheet" href="https://fonts.googleapis.com/css?family=Fira+Mono|Lato|Raleway">

		
	</head>

  <body>
    <header class="container no-print">
      <nav id="navbar"
           style="
                  margin-bottom: 3rem;
                  padding-top: 1rem;
                  display: flex;
                  flex-wrap: wrap;
                  align-items: flex-end;
                  column-gap: 1.7rem;
                  "             >
        <a href="/"
           >
          <h1 style="
                     margin: 0.2rem 0;
                     padding: 0;
                     font-size: 1.6rem;
                     font-family: roman;
                     color: #777;
                     ">
            Adriaan Leijnse
          </h1>
        </a>
        <ul>
          <li>
            <a href="/blog/"
               
               >
              Blog
            </a>
          </li><li>
            <a href="/foc-ideas/"
               
               >
              Future of Coding
            </a>
          </li><li>
            <a href="/journal/"
               
               class="active"
               
               >
              Journal
            </a>
          </li><li>
            <a href="/papers/"
               
               >
              Papers
            </a>
          </li></ul>
      </nav>
    </header>
    <main class="container">

<article>
  <header>
    <hgroup id="brand">
      <h1>
        Journal entry for 
	
        
	<time datetime="2025-03-23 00:00:00 &#43;0000 UTC">March 23, 2025</time>
        
	<span class="no-print">
	  <span>
      </h1>
    </hgroup>
    <hr class="sep" />
  </header>
  <p>I&rsquo;ve been thinking about why GHC&rsquo;s front-end code is so big and complicated/fragile feeling.
I think it might be because of the huge <code>Expr</code> data structure that is meant to represent the full surface syntax, and is used throughout the parser, renamer, and type checker phases.
Maybe this makes it so that various concerns are all intermingled, even though there are these separate &ldquo;phases&rdquo; that traditional compiler designers like to use.</p>
<p>A Scheme implementation doesn&rsquo;t feel like that.
Instead they are written as a tiny but fully featured base language with a nice hygienic macro system, and macros are used to implement all the extra features.</p>
<p>I think the hard part about this is to achieve good error reporting.
I wonder how Typed Racket does it.</p>
<p>In any case, GHC differs significantly from this, because <code>Core</code> is a very simple AST, without any source information.
Everything to do with nice surface syntax <em>has</em> to happen somewhere else, because there doesn&rsquo;t seem to be a way to connect <code>Core</code> to the original program.</p>
<p>Also, while GHC technically has macros it really isn&rsquo;t possible to make new syntax that feels native.
Macro calls have to be in special delimiters.</p>

</article>
<nav class="no-print post-nav">
  
  <a class="prev-post" href="https://aidy.dev/journal/2025-03-08/">
    <img class="icon-text" src="/img/prev.svg"/>2025-03-08</a>
  
  
  <a class="next-post" href="https://aidy.dev/journal/2025-03-28/">2025-03-28<img class="icon-text" src="/img/next.svg"/>
  </a>
  
</nav>





		        <hr class="bottom-sep" />
		</main>
		<footer class="container no-print">
			<div class="u-footer">
				
<a href="https://github.com/parenthetical"><img class="icon-zocial" src="/img/github.svg" alt="Github"/></a>
<a href="https://twitter.com/aidylns"><img class="icon-zocial" src="/img/twitter.svg" alt="Twitter"/></a>

			</div>
		</footer>
		
   </body>
<script type="text/javascript"
  src="/tex-mml-chtml.js">
</script>
</html>

